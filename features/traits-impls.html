<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Traits and implementations - The Hash Programming Language</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../features/intro.html"><strong aria-hidden="true">2.</strong> Language features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../features/name-bindings.html"><strong aria-hidden="true">2.1.</strong> Name bindings</a></li><li class="chapter-item expanded "><a href="../features/functions.html"><strong aria-hidden="true">2.2.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../features/primitives.html"><strong aria-hidden="true">2.3.</strong> Primitives</a></li><li class="chapter-item expanded "><a href="../features/control-flow.html"><strong aria-hidden="true">2.4.</strong> ðŸš§ Control flow</a></li><li class="chapter-item expanded "><a href="../features/operators.html"><strong aria-hidden="true">2.5.</strong> ðŸš§ Operators</a></li><li class="chapter-item expanded "><a href="../features/types.html"><strong aria-hidden="true">2.6.</strong> ðŸš§ Types</a></li><li class="chapter-item expanded "><a href="../features/structs-enums.html"><strong aria-hidden="true">2.7.</strong> Structs and enums</a></li><li class="chapter-item expanded "><a href="../features/modules.html"><strong aria-hidden="true">2.8.</strong> Modules and visibility</a></li><li class="chapter-item expanded "><a href="../features/patterns.html"><strong aria-hidden="true">2.9.</strong> Patterns</a></li><li class="chapter-item expanded "><a href="../features/traits-impls.html" class="active"><strong aria-hidden="true">2.10.</strong> Traits and implementations</a></li><li class="chapter-item expanded "><a href="../features/type-functions.html"><strong aria-hidden="true">2.11.</strong> Type functions</a></li><li class="chapter-item expanded "><a href="../features/memory.html"><strong aria-hidden="true">2.12.</strong> ðŸš§ Memory management</a></li><li class="chapter-item expanded "><a href="../features/directives.html"><strong aria-hidden="true">2.13.</strong> ðŸš§ Directives</a></li></ol></li><li class="chapter-item expanded "><a href="../standard-library/intro.html"><strong aria-hidden="true">3.</strong> Standard library</a></li><li class="chapter-item expanded "><a href="../interpreter/intro.html"><strong aria-hidden="true">4.</strong> Interpreter</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../interpreter/options.html"><strong aria-hidden="true">4.1.</strong> Interpreter options</a></li><li class="chapter-item expanded "><a href="../interpreter/backends.html"><strong aria-hidden="true">4.2.</strong> Compiler backends</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced/intro.html"><strong aria-hidden="true">5.</strong> Advanced concepts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/compiler-internals.html"><strong aria-hidden="true">5.1.</strong> Compiler internals</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../advanced/loop-transpilation.html"><strong aria-hidden="true">5.1.1.</strong> Loop transpilation</a></li><li class="chapter-item expanded "><a href="../advanced/if-statement-transpilation.html"><strong aria-hidden="true">5.1.2.</strong> If statement transpilation</a></li><li class="chapter-item expanded "><a href="../advanced/type-inference.html"><strong aria-hidden="true">5.1.3.</strong> Type inference</a></li></ol></li><li class="chapter-item expanded "><a href="../advanced/future-features.html"><strong aria-hidden="true">5.2.</strong> Future features</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Hash Programming Language</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/hash-org/lang" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="traits-and-implementations"><a class="header" href="#traits-and-implementations">Traits and implementations</a></h1>
<h2 id="traits"><a class="header" href="#traits">Traits</a></h2>
<p>Hash supports compile-time polymorphism through traits.
Traits are a core mechanism in Hash; they allow for different implementations of the same set of operations, for different types.
They are similar to traits in Rust, type-classes in Haskell, and protocols in Swift.
For example:</p>
<pre><code class="language-rs">Printable := trait {
  print: (Self) -&gt; void;
};
</code></pre>
<p>The above declares a trait called <code>Printable</code> which has a single associated function <code>print</code>.
The special type <code>Self</code> denotes the type for which the trait is implemented.</p>
<p>Traits can be implemented for types in the following way:</p>
<pre><code class="language-rs">Dog := struct(
  name: str,
  age: i32,
);

Dog ~= Printable {
  // `Self = Dog` inferred
  print = (self) =&gt; io::printf(f&quot;Doge with name {self.name} and age {self.age}&quot;);
};
</code></pre>
<p>Now a <code>Dog</code> is assignable to any type that has bound <code>Printable</code>.</p>
<p>The <code>~=</code> operator is the combination of <code>~</code> and <code>=</code> operators, and it is equivalent to </p>
<pre><code class="language-rs">Dog = Dog ~ Printable { ... };
</code></pre>
<p>The <code>~</code> operator means &quot;attach&quot;, and it is used to attach implementations of traits to structs and enums.</p>
<p>Trait implementations can be created without having to attach them to a specific type:</p>
<pre><code class="language-rs">DogPrintable := Printable {
  Self = Dog, // Self can no longer be inferred, it needs to be explicitly specified.
  print = (self) =&gt; io.printf(f&quot;Doge with name {self.name} and age {self.age}&quot;);
};

doge := Dog(..);
DogPrintable::print(doge); // Trait implementations can be called explicitly like this

Dog ~= DogPrintable; // `DogPrintable` can be attached to `Dog` as long as `DogPrintable::Self = Dog`.

// Then you can also do this, and it will be resolved to `DogPrintable::print(doge)`:
doge.print();
</code></pre>
<p>Traits can also be generic over other types:</p>
<pre><code class="language-rs">Sequence := &lt;T&gt; =&gt; trait {
  at: (self, index: usize) -&gt; Option&lt;T&gt;;
  slice: (self, start: usize, end: usize) -&gt; Self;
};

List := &lt;T&gt; =&gt; struct(...);

// For List (of type `&lt;T: type&gt; -&gt; type`) implement Sequence (of type `&lt;T: type&gt; -&gt; trait`):
// This will be implemented for all `T`.
List ~= Sequence; 
</code></pre>
<p>Notice that in addition to traits, type functions returning traits can also be implemented for other type functions returning types.
This is possible as long as both functions on the left hand side and right hand side match:</p>
<pre><code class="language-rs">SomeTrait := &lt;T&gt; =&gt; trait {
  Self: type; // Restrict what `Self` can be
  ...
};

// Allowed: `&lt;T: type&gt; -&gt; trait` attachable to `&lt;T: type&gt; -&gt; type`.
(&lt;T&gt; =&gt; SomeType) ~= (&lt;T&gt; =&gt; SomeTrait&lt;T&gt; {...});

// Not allowed: `&lt;T: type&gt; -&gt; trait` is not attachable to `type`
SomeType ~= (&lt;T&gt; =&gt; SomeTrait&lt;T&gt; {...});

// Not allowed: `trait` is not attachable to `&lt;T: type&gt; -&gt; type` because
// `SomeTraitImpl::Self` has type `type` and not `&lt;T: type&gt; -&gt; type`.
SomeType ~= (&lt;T&gt; =&gt; SomeTrait&lt;T&gt; {...});
</code></pre>
<p>Furthermore, traits do not need to have a self type:</p>
<pre><code class="language-rs">Convert := &lt;I, O&gt; =&gt; trait {
  convert: (I) -&gt; O;
};

ConvertDogeToGatos := Convert&lt;Doge, Gatos&gt; {
  convert = (doge) =&gt; perform_transformation_from_doge_to_gatos(doge);
};

doggo := Doge(...);
kitty := ConvertDogeToGatos::convert(doggo);
</code></pre>
<p>Traits can also be used as bounds on type parameters:</p>
<pre><code class="language-rs">print_things_if_eq := &lt;Thing: Printable ~ Eq&gt; =&gt; (thing1: Thing, Thing2: thing) =&gt; {
  if thing1 == thing2 {
    print(thing1);
    print(thing2);
  }
};
</code></pre>
<p>Here, <code>Thing</code> must implement <code>Printable</code> and <code>Eq</code>.
Notice the same attachment syntax (<code>~</code>) for multiple trait bounds, just as for attaching trait implementations to types.</p>
<p>Traits are monomorphised at runtime, and thus are completely erased.
Therefore, there is no additional runtime overhead to structuring your code using lots of traits/generics and polymorphism, vs using plain old functions without any generics.
There is, however, additional compile-time cost to very complicated trait hierarchies and trait bounds.</p>
<h2 id="implementations"><a class="header" href="#implementations">Implementations</a></h2>
<p>Implementations can be attached to types without having to implement a specific trait, using <code>impl</code> blocks.
These are equivalent to trait implementation blocks, but do not correspond to any trait, and just attach the given items to the type as associated items.
Example:</p>
<pre><code class="language-rs">Vector3 := &lt;T&gt; =&gt; struct(x: T, y: T, z: T);

Vector3 ~= &lt;T: Mul ~ Sub&gt; =&gt; impl {
  // Cross is an associated function on `Vector3&lt;T&gt;` for any `T: Mul ~ Sub`.
  cross := (self, other: Self) -&gt; Self =&gt; {
      Vector3(
        self.y * other.z - self.z * other.y,
        self.z * other.x - self.x * other.z,
        self.x * other.y - self.y * other.x,
      )
  };
};

print(Vector3(1, 2, 3).cross(Vector3(4, 5, 6)));
</code></pre>
<p>By default, members of <code>impl</code> blocks are public, but <code>priv</code> can be written to make them private.</p>
<h2 id="grammar"><a class="header" href="#grammar">Grammar</a></h2>
<p>The grammar for trait definitions is as follows:</p>
<pre><code>trait_def = &quot;trait&quot; &quot;{&quot; ( expr &quot;;&quot; )* &quot;}&quot;
</code></pre>
<p>The grammar for trait implementations is as follows:</p>
<pre><code>trait_impl = ident &quot;{&quot; ( expr &quot;;&quot; )* &quot;}&quot;
</code></pre>
<p>The grammar for standalone <code>impl</code> blocks is as follows:</p>
<pre><code>impl_block = &quot;impl&quot; &quot;{&quot; ( expr &quot;;&quot; )* &quot;}&quot;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../features/patterns.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../features/type-functions.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../features/patterns.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../features/type-functions.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
